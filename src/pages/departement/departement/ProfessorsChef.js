import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { useState, useMemo } from 'react';
import { motion } from 'framer-motion';
import { BookOpen, Users, CheckCircle, Gavel, FileCheck, BarChart3, Search, Eye, Mail, Award, User } from 'lucide-react';
import { useAuth } from '../../../contexts/AuthContext';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../../../components/ui/tabs';
import { Input } from '../../../components/ui/input';
import { Card, CardContent, CardHeader, CardTitle } from '../../../components/ui/card';
import { Button } from '../../../components/ui/button';
import { Badge } from '../../../components/ui/badge';
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '../../../components/ui/dialog';
import { mockProfesseurs } from '../../../models/acteurs/Professeur';
import { getSujetsProposesByProfesseur, getSujetsValidesByProfesseur, getEtudiantsEncadresByProfesseur, getJurysByProfesseur, getStatistiquesEncadrement, getCorrectionsValideesByProfesseur } from '../../../models/services/ProfesseurEspace.service';
import SujetsProposesTab from '../../professeur/tabs/SujetsProposesTab';
import EtudiantsEncadresTab from '../../professeur/tabs/EtudiantsEncadresTab';
import SujetsValidesTab from '../../professeur/tabs/SujetsValidesTab';
import JurysTab from '../../professeur/tabs/JurysTab';
import CorrectionsValideesTab from '../../professeur/tabs/CorrectionsValideesTab';
import StatistiquesTab from '../../professeur/tabs/StatistiquesTab';
const ProfessorsChef = () => {
    const { user } = useAuth();
    const [searchQuery, setSearchQuery] = useState('');
    const [selectedProfesseur, setSelectedProfesseur] = useState(null);
    const [isModalOpen, setIsModalOpen] = useState(false);
    const [activeTab, setActiveTab] = useState('sujets-proposes');
    const [tabSearchQuery, setTabSearchQuery] = useState('');
    // Récupérer les professeurs du département (pour le chef de département)
    // Si l'utilisateur est chef, on filtre par son département
    const professeursDepartement = useMemo(() => {
        if (!user)
            return [];
        const departement = user.department || 'Département Informatique';
        return mockProfesseurs.filter(p => p.departement === departement);
    }, [user]);
    // Filtrer les professeurs par recherche
    const professeursFiltres = useMemo(() => {
        if (!searchQuery.trim())
            return professeursDepartement;
        const query = searchQuery.toLowerCase();
        return professeursDepartement.filter(p => {
            var _a, _b;
            return `${p.prenom} ${p.nom}`.toLowerCase().includes(query) ||
                p.email.toLowerCase().includes(query) ||
                ((_a = p.specialite) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes(query)) ||
                ((_b = p.grade) === null || _b === void 0 ? void 0 : _b.toLowerCase().includes(query));
        });
    }, [professeursDepartement, searchQuery]);
    const handleViewProfesseur = (professeur) => {
        setSelectedProfesseur(professeur);
        setIsModalOpen(true);
        setActiveTab('sujets-proposes');
        setTabSearchQuery('');
    };
    // Récupérer les données pour le professeur sélectionné
    const professeurId = (selectedProfesseur === null || selectedProfesseur === void 0 ? void 0 : selectedProfesseur.idProfesseur) || 0;
    const estCommission = (selectedProfesseur === null || selectedProfesseur === void 0 ? void 0 : selectedProfesseur.estCommission) || false;
    const sujetsProposes = useMemo(() => professeurId > 0 ? getSujetsProposesByProfesseur(professeurId) : [], [professeurId]);
    const sujetsValides = useMemo(() => professeurId > 0 ? getSujetsValidesByProfesseur(professeurId) : new Map(), [professeurId]);
    const etudiantsEncadres = useMemo(() => professeurId > 0 ? getEtudiantsEncadresByProfesseur(professeurId) : [], [professeurId]);
    const jurys = useMemo(() => professeurId > 0 ? getJurysByProfesseur(professeurId) : [], [professeurId]);
    const correctionsValidees = useMemo(() => professeurId > 0 ? getCorrectionsValideesByProfesseur(professeurId, estCommission) : new Map(), [professeurId, estCommission]);
    const statistiques = useMemo(() => professeurId > 0 ? getStatistiquesEncadrement(professeurId) : {
        totalEncadrements: 0,
        encadrementsActifs: 0,
        encadrementsTermines: 0,
        totalEtudiants: 0,
        dossiersSoutenus: 0,
        dossiersValides: 0,
        tauxReussite: 0
    }, [professeurId]);
    return (_jsx("div", { className: "min-h-screen bg-gray-50", children: _jsxs("div", { className: "max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8", children: [_jsxs(motion.div, { initial: { opacity: 0, y: -20 }, animate: { opacity: 1, y: 0 }, className: "mb-8", children: [_jsx("h1", { className: "text-3xl font-bold text-gray-900 mb-2", children: "Professeurs du D\u00E9partement" }), _jsx("p", { className: "text-gray-600", children: "Consultez les informations et activit\u00E9s des professeurs de votre d\u00E9partement" })] }), _jsx("div", { className: "mb-6", children: _jsxs("div", { className: "relative", children: [_jsx(Search, { className: "absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5" }), _jsx(Input, { type: "text", placeholder: "Rechercher un professeur...", value: searchQuery, onChange: (e) => setSearchQuery(e.target.value), className: "pl-10" })] }) }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-4 gap-4 mb-6", children: [_jsxs(Card, { children: [_jsx(CardHeader, { className: "pb-2", children: _jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "Total professeurs" }) }), _jsx(CardContent, { children: _jsx("div", { className: "text-2xl font-bold text-primary", children: professeursDepartement.length }) })] }), _jsxs(Card, { children: [_jsx(CardHeader, { className: "pb-2", children: _jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "Encadrants" }) }), _jsx(CardContent, { children: _jsx("div", { className: "text-2xl font-bold text-blue-600", children: professeursDepartement.filter(p => p.estEncadrant).length }) })] }), _jsxs(Card, { children: [_jsx(CardHeader, { className: "pb-2", children: _jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "Membres jury" }) }), _jsx(CardContent, { children: _jsx("div", { className: "text-2xl font-bold text-purple-600", children: professeursDepartement.filter(p => p.estJurie).length }) })] }), _jsxs(Card, { children: [_jsx(CardHeader, { className: "pb-2", children: _jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "Commission" }) }), _jsx(CardContent, { children: _jsx("div", { className: "text-2xl font-bold text-green-600", children: professeursDepartement.filter(p => p.estCommission).length }) })] })] }), professeursFiltres.length === 0 ? (_jsx(Card, { children: _jsxs(CardContent, { className: "py-12 text-center", children: [_jsx(User, { className: "h-12 w-12 text-gray-400 mx-auto mb-4" }), _jsx("p", { className: "text-gray-600", children: "Aucun professeur trouv\u00E9" })] }) })) : (_jsx(Card, { children: _jsx(CardContent, { className: "p-0", children: _jsx("div", { className: "overflow-x-auto", children: _jsxs("table", { className: "w-full", children: [_jsx("thead", { children: _jsxs("tr", { className: "border-b border-gray-200 bg-gray-50", children: [_jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Professeur" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Email" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Grade" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Sp\u00E9cialit\u00E9" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Encadrements" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Statut" }), _jsx("th", { className: "px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Actions" })] }) }), _jsx("tbody", { className: "bg-white divide-y divide-gray-200", children: professeursFiltres.map((professeur, index) => (_jsxs(motion.tr, { initial: { opacity: 0 }, animate: { opacity: 1 }, transition: { delay: index * 0.02 }, className: "hover:bg-gray-50 transition-colors", children: [_jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsxs("div", { className: "flex items-center", children: [_jsx("div", { className: "flex-shrink-0 h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center", children: _jsx(User, { className: "h-5 w-5 text-primary" }) }), _jsx("div", { className: "ml-4", children: _jsxs("div", { className: "text-sm font-medium text-gray-900", children: [professeur.prenom, " ", professeur.nom] }) })] }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsxs("div", { className: "text-sm text-gray-600 flex items-center gap-2", children: [_jsx(Mail, { className: "h-4 w-4" }), professeur.email] }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsx("div", { className: "text-sm text-gray-600 flex items-center gap-2", children: professeur.grade ? (_jsxs(_Fragment, { children: [_jsx(Award, { className: "h-4 w-4" }), professeur.grade] })) : (_jsx("span", { className: "text-gray-400", children: "-" })) }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsx("div", { className: "text-sm text-gray-600", children: professeur.specialite || _jsx("span", { className: "text-gray-400", children: "-" }) }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsx("div", { className: "text-sm text-gray-600", children: professeur.estEncadrant ? (_jsxs("span", { children: [professeur.nombreEncadrementsActuels || 0, "/", professeur.capaciteEncadrement || 0] })) : (_jsx("span", { className: "text-gray-400", children: "-" })) }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: professeur.estDisponible ? (_jsx(Badge, { className: "bg-green-100 text-green-700 border-green-200", children: "Disponible" })) : (_jsx(Badge, { className: "bg-gray-100 text-gray-700 border-gray-200", children: "Indisponible" })) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium", children: _jsxs(Button, { variant: "outline", size: "sm", onClick: () => handleViewProfesseur(professeur), children: [_jsx(Eye, { className: "h-4 w-4 mr-2" }), "Consulter"] }) })] }, professeur.idProfesseur))) })] }) }) }) })), _jsx(Dialog, { open: isModalOpen, onOpenChange: setIsModalOpen, children: _jsxs(DialogContent, { className: "max-w-6xl max-h-[90vh] overflow-y-auto", children: [_jsxs(DialogHeader, { children: [_jsx(DialogTitle, { className: "text-2xl", children: selectedProfesseur && `${selectedProfesseur.prenom} ${selectedProfesseur.nom}` }), _jsxs(DialogDescription, { children: [(selectedProfesseur === null || selectedProfesseur === void 0 ? void 0 : selectedProfesseur.grade) && `${selectedProfesseur.grade}`, (selectedProfesseur === null || selectedProfesseur === void 0 ? void 0 : selectedProfesseur.specialite) && ` - ${selectedProfesseur.specialite}`] })] }), selectedProfesseur && (_jsxs("div", { className: "mt-4", children: [_jsx("div", { className: "mb-6 p-4 bg-gray-50 rounded-lg", children: _jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-4 text-sm", children: [_jsxs("div", { children: [_jsx("strong", { className: "text-gray-700", children: "Email:" }), _jsx("p", { className: "text-gray-600", children: selectedProfesseur.email })] }), selectedProfesseur.departement && (_jsxs("div", { children: [_jsx("strong", { className: "text-gray-700", children: "D\u00E9partement:" }), _jsx("p", { className: "text-gray-600", children: selectedProfesseur.departement })] })), selectedProfesseur.estEncadrant && (_jsxs("div", { children: [_jsx("strong", { className: "text-gray-700", children: "Encadrements:" }), _jsxs("p", { className: "text-gray-600", children: [selectedProfesseur.nombreEncadrementsActuels || 0, "/", selectedProfesseur.capaciteEncadrement || 0] })] })), _jsxs("div", { children: [_jsx("strong", { className: "text-gray-700", children: "Statut:" }), _jsx("p", { className: "text-gray-600", children: selectedProfesseur.estDisponible ? (_jsx(Badge, { className: "bg-green-100 text-green-700", children: "Disponible" })) : (_jsx(Badge, { className: "bg-gray-100 text-gray-700", children: "Indisponible" })) })] })] }) }), _jsxs(Tabs, { value: activeTab, onValueChange: setActiveTab, className: "w-full", children: [_jsxs(TabsList, { className: "grid w-full grid-cols-6 mb-6", children: [_jsxs(TabsTrigger, { value: "sujets-proposes", className: "flex items-center gap-2", children: [_jsx(BookOpen, { className: "h-4 w-4" }), _jsx("span", { className: "hidden sm:inline", children: "Sujets propos\u00E9s" })] }), _jsxs(TabsTrigger, { value: "statistiques", className: "flex items-center gap-2", children: [_jsx(BarChart3, { className: "h-4 w-4" }), _jsx("span", { className: "hidden sm:inline", children: "Statistiques" })] }), _jsxs(TabsTrigger, { value: "etudiants-encadres", className: "flex items-center gap-2", children: [_jsx(Users, { className: "h-4 w-4" }), _jsx("span", { className: "hidden sm:inline", children: "\u00C9tudiants encadr\u00E9s" })] }), _jsxs(TabsTrigger, { value: "sujets-valides", className: "flex items-center gap-2", children: [_jsx(CheckCircle, { className: "h-4 w-4" }), _jsx("span", { className: "hidden sm:inline", children: "Sujets trait\u00E9s" })] }), _jsxs(TabsTrigger, { value: "jurys", className: "flex items-center gap-2", children: [_jsx(Gavel, { className: "h-4 w-4" }), _jsx("span", { className: "hidden sm:inline", children: "Jurys" })] }), _jsxs(TabsTrigger, { value: "corrections-validees", className: "flex items-center gap-2", children: [_jsx(FileCheck, { className: "h-4 w-4" }), _jsx("span", { className: "hidden sm:inline", children: "Corrections trait\u00E9es" })] })] }), _jsx(TabsContent, { value: "sujets-proposes", className: "mt-6", children: _jsx(SujetsProposesTab, { sujets: sujetsProposes, searchQuery: tabSearchQuery, onSearchChange: setTabSearchQuery }) }), _jsx(TabsContent, { value: "statistiques", className: "mt-6", children: _jsx(StatistiquesTab, { statistiques: statistiques }) }), _jsx(TabsContent, { value: "etudiants-encadres", className: "mt-6", children: _jsx(EtudiantsEncadresTab, { etudiants: etudiantsEncadres, searchQuery: tabSearchQuery, onSearchChange: setTabSearchQuery }) }), _jsx(TabsContent, { value: "sujets-valides", className: "mt-6", children: _jsx(SujetsValidesTab, { sujets: sujetsValides, searchQuery: tabSearchQuery, onSearchChange: setTabSearchQuery }) }), _jsx(TabsContent, { value: "jurys", className: "mt-6", children: _jsx(JurysTab, { jurys: jurys, searchQuery: tabSearchQuery, onSearchChange: setTabSearchQuery }) }), _jsx(TabsContent, { value: "corrections-validees", className: "mt-6", children: _jsx(CorrectionsValideesTab, { corrections: correctionsValidees, searchQuery: tabSearchQuery, onSearchChange: setTabSearchQuery }) })] })] }))] }) })] }) }));
};
export default ProfessorsChef;
