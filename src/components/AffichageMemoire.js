import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { motion } from "framer-motion";
import { useState } from "react";
const AffichageMemoire = ({ memoire, onRetour }) => {
    const [ongletActif, setOngletActif] = useState("resume");
    // État pour le formulaire de contact
    const [formContact, setFormContact] = useState({
        nom: "",
        email: "",
        message: ""
    });
    const [envoiReussi, setEnvoiReussi] = useState(false);
    const onglets = [
        { id: "resume", label: "Résumé", icone: "article" },
        { id: "document", label: "Document PDF", icone: "picture_as_pdf" },
        { id: "contact", label: "Contact", icone: "contact_page" }
    ];
    // Gestion du changement des champs du formulaire
    const handleInputChange = (e) => {
        const { id, value } = e.target;
        setFormContact(prev => (Object.assign(Object.assign({}, prev), { [id]: value })));
    };
    // Envoi du message via mailto: - envoie à tous les membres du groupe
    const handleEnvoyerMessage = (e) => {
        e.preventDefault();
        // Validation
        if (!formContact.nom || !formContact.email || !formContact.message) {
            alert("Veuillez remplir tous les champs du formulaire.");
            return;
        }
        // Récupérer tous les emails des contacts (pour les groupes)
        const tousLesEmails = memoire.contacts.map(c => c.email).join(',');
        const nomsAuteurs = memoire.contacts.map(c => c.nom).join(' & ');
        // Créer le sujet et le corps du mail
        const sujet = encodeURIComponent(`[ISI Mémoires] Message de ${formContact.nom} concernant : ${memoire.titre}`);
        const corps = encodeURIComponent(`Bonjour ${nomsAuteurs},\n\n` +
            `Vous avez reçu un message concernant votre mémoire "${memoire.titre}".\n\n` +
            `--- Message ---\n` +
            `${formContact.message}\n\n` +
            `--- Expéditeur ---\n` +
            `Nom: ${formContact.nom}\n` +
            `Email: ${formContact.email}\n\n` +
            `---\n` +
            `Ce message a été envoyé via la plateforme ISI Mémoires.`);
        // Ouvrir le client mail avec tous les destinataires
        const mailtoUrl = `mailto:${tousLesEmails}?subject=${sujet}&body=${corps}`;
        window.open(mailtoUrl, '_blank');
        // Afficher message de succès
        setEnvoiReussi(true);
        // Réinitialiser le formulaire après 3 secondes
        setTimeout(() => {
            setFormContact({ nom: "", email: "", message: "" });
            setEnvoiReussi(false);
        }, 3000);
    };
    return (_jsx("div", { className: "container-fluid py-8", children: _jsxs(motion.div, { initial: { opacity: 0 }, animate: { opacity: 1 }, transition: { duration: 0.5 }, children: [_jsxs("div", { className: "flex items-center mb-8", children: [_jsx("button", { onClick: onRetour, className: "mr-4 p-2 bg-gray-100 hover:bg-gray-200 rounded-full transition-colors", children: _jsx("span", { className: "material-icons", children: "arrow_back" }) }), _jsx("h1", { className: "text-2xl font-bold text-navy", children: "Consultation du m\u00E9moire" })] }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-8", children: [_jsx(motion.div, { className: "md:col-span-1", initial: { x: -20, opacity: 0 }, animate: { x: 0, opacity: 1 }, transition: { delay: 0.2, duration: 0.5 }, children: _jsxs("div", { className: "bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100", children: [_jsxs("div", { className: "h-48 bg-gradient-to-br from-primary-50 to-primary-100 relative flex items-center justify-center", children: [_jsx("div", { className: "w-full h-full flex items-center justify-center", children: _jsx("span", { className: "material-icons text-primary text-6xl", children: "picture_as_pdf" }) }), _jsx("div", { className: "absolute top-4 right-4 bg-primary text-white text-xs font-bold px-2 py-1 rounded", children: "PDF" })] }), _jsxs("div", { className: "p-6", children: [_jsx("h2", { className: "text-xl font-bold text-navy mb-2 line-clamp-2", children: memoire.titre }), _jsxs("p", { className: "text-gray-600 mb-4", children: ["Par ", memoire.auteur] }), _jsxs("div", { className: "space-y-3", children: [_jsxs("div", { className: "flex items-center text-sm", children: [_jsx("span", { className: "material-icons text-primary text-lg mr-2", children: "school" }), _jsx("span", { className: "text-gray-700", children: memoire.formation })] }), _jsxs("div", { className: "flex items-center text-sm", children: [_jsx("span", { className: "material-icons text-primary text-lg mr-2", children: "business" }), _jsx("span", { className: "text-gray-700", children: memoire.departement })] }), _jsxs("div", { className: "flex items-center text-sm", children: [_jsx("span", { className: "material-icons text-primary text-lg mr-2", children: "calendar_today" }), _jsx("span", { className: "text-gray-700", children: memoire.annee })] })] }), _jsx("div", { className: "mt-4 flex flex-wrap gap-2", children: memoire.etiquettes.slice(0, 4).map((tag, index) => (_jsx("span", { className: "bg-primary-50 text-primary text-xs px-2 py-1 rounded-full", children: tag }, index))) }), _jsx("div", { className: "mt-6", children: _jsxs("a", { href: memoire.cheminFichier, target: "_blank", rel: "noopener noreferrer", className: "w-full bg-primary hover:bg-primary-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center", children: [_jsx("span", { className: "material-icons mr-2 text-sm", children: "visibility" }), "Consulter le PDF"] }) })] })] }) }), _jsx(motion.div, { className: "md:col-span-2", initial: { y: 20, opacity: 0 }, animate: { y: 0, opacity: 1 }, transition: { delay: 0.3, duration: 0.5 }, children: _jsxs("div", { className: "bg-white rounded-xl shadow-lg border border-gray-100", children: [_jsx("div", { className: "border-b border-gray-200", children: _jsx("div", { className: "flex", children: onglets.map((onglet) => (_jsxs("button", { onClick: () => setOngletActif(onglet.id), className: `flex-1 py-4 px-6 flex items-center justify-center font-medium transition-colors ${ongletActif === onglet.id
                                                    ? "text-primary border-b-2 border-primary bg-primary-50"
                                                    : "text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`, children: [_jsx("span", { className: "material-icons mr-2 text-sm", children: onglet.icone }), onglet.label] }, onglet.id))) }) }), _jsxs("div", { className: "p-6", children: [ongletActif === "resume" && (_jsxs("div", { children: [_jsx("h3", { className: "text-xl font-bold mb-4 text-navy", children: "R\u00E9sum\u00E9 du m\u00E9moire" }), _jsx("div", { className: "prose prose-blue max-w-none", children: _jsx("p", { className: "text-navy-700 leading-relaxed whitespace-pre-line", children: memoire.resume || memoire.description }) })] })), ongletActif === "document" && (_jsxs("div", { children: [_jsx("h3", { className: "text-xl font-bold mb-4 text-navy", children: "Document PDF" }), _jsxs("div", { className: "mb-4 flex justify-between items-center", children: [_jsx("p", { className: "text-gray-600", children: "Visualisez le document complet ci-dessous" }), _jsxs("a", { href: memoire.cheminFichier, target: "_blank", rel: "noopener noreferrer", className: "text-primary hover:text-primary-700 flex items-center transition-colors", children: [_jsx("span", { className: "material-icons mr-1 text-sm", children: "open_in_new" }), "Ouvrir dans un nouvel onglet"] })] }), _jsx("div", { className: "border border-gray-200 rounded-lg overflow-hidden bg-gray-100", children: _jsx("object", { data: memoire.cheminFichier, type: "application/pdf", className: "w-full h-[600px]", children: _jsxs("div", { className: "p-8 text-center", children: [_jsx("div", { className: "w-20 h-20 mx-auto bg-primary-50 rounded-full flex items-center justify-center mb-4", children: _jsx("span", { className: "material-icons text-primary text-3xl", children: "picture_as_pdf" }) }), _jsx("p", { className: "text-gray-600 mb-4", children: "Impossible d'afficher le PDF directement dans le navigateur." }), _jsxs("a", { href: memoire.cheminFichier, target: "_blank", rel: "noopener noreferrer", className: "inline-flex items-center bg-primary hover:bg-primary-700 text-white font-medium py-3 px-6 rounded-lg transition-colors", children: [_jsx("span", { className: "material-icons mr-2", children: "open_in_new" }), "Ouvrir le PDF"] })] }) }) }), _jsxs("div", { className: "mt-4 px-4 py-3 bg-blue-50 text-sm text-blue-700 flex items-center rounded-lg", children: [_jsx("span", { className: "material-icons text-sm mr-2", children: "info" }), "Ce document peut \u00EAtre consult\u00E9 en ligne. Pour une meilleure exp\u00E9rience, ouvrez-le dans un nouvel onglet."] })] })), ongletActif === "contact" && (_jsxs("div", { children: [_jsxs("h3", { className: "text-xl font-bold mb-4 text-navy", children: ["Contacter ", memoire.contacts.length > 1 ? "les auteurs" : "l'auteur"] }), _jsx("div", { className: "space-y-6", children: memoire.contacts.map((contact, index) => (_jsxs("div", { className: "p-4 bg-gray-50 rounded-lg border border-gray-100", children: [_jsxs("h4", { className: "font-semibold text-navy mb-3 flex items-center", children: [_jsx("span", { className: "material-icons text-primary mr-2", children: "person" }), contact.nom] }), _jsxs("div", { className: "space-y-2 ml-8", children: [_jsxs("div", { className: "flex items-center", children: [_jsx("span", { className: "material-icons text-blue-500 text-sm mr-2", children: "email" }), _jsx("a", { href: `mailto:${contact.email}`, className: "text-blue-600 hover:underline text-sm", children: contact.email })] }), _jsxs("div", { className: "flex items-center", children: [_jsx("span", { className: "material-icons text-green-500 text-sm mr-2", children: "phone" }), _jsx("a", { href: `tel:${contact.telephone.replace(/\s/g, '')}`, className: "text-green-600 hover:underline text-sm", children: contact.telephone })] })] })] }, index))) }), _jsxs("div", { className: "mt-8 pt-6 border-t border-gray-100", children: [_jsx("h4", { className: "text-lg font-semibold mb-4", children: "Envoyer un message" }), envoiReussi && (_jsxs("div", { className: "mb-4 p-4 bg-green-50 border border-green-200 rounded-lg flex items-center text-green-700", children: [_jsx("span", { className: "material-icons mr-2", children: "check_circle" }), _jsxs("span", { children: ["Votre client mail s'est ouvert avec le message pr\u00E9-rempli", memoire.contacts.length > 1 ? ` pour les ${memoire.contacts.length} destinataires` : '', "."] })] })), _jsxs("form", { onSubmit: handleEnvoyerMessage, className: "space-y-4", children: [_jsxs("div", { children: [_jsxs("label", { htmlFor: "nom", className: "block text-sm font-medium text-navy-700 mb-1", children: ["Votre nom ", _jsx("span", { className: "text-red-500", children: "*" })] }), _jsx("input", { type: "text", id: "nom", value: formContact.nom, onChange: handleInputChange, required: true, className: "w-full p-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent", placeholder: "Entrez votre nom" })] }), _jsxs("div", { children: [_jsxs("label", { htmlFor: "email", className: "block text-sm font-medium text-navy-700 mb-1", children: ["Votre email ", _jsx("span", { className: "text-red-500", children: "*" })] }), _jsx("input", { type: "email", id: "email", value: formContact.email, onChange: handleInputChange, required: true, className: "w-full p-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent", placeholder: "Entrez votre email" })] }), _jsxs("div", { children: [_jsxs("label", { htmlFor: "message", className: "block text-sm font-medium text-navy-700 mb-1", children: ["Message ", _jsx("span", { className: "text-red-500", children: "*" })] }), _jsx("textarea", { id: "message", rows: 4, value: formContact.message, onChange: handleInputChange, required: true, className: "w-full p-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent", placeholder: "Votre message pour l'auteur" })] }), _jsxs("button", { type: "submit", className: "bg-primary hover:bg-primary-700 text-white font-medium py-3 px-6 rounded-lg transition-colors flex items-center", children: [_jsx("span", { className: "material-icons mr-2 text-sm", children: "send" }), "Envoyer ", memoire.contacts.length > 1 ? `aux ${memoire.contacts.length} auteurs` : "le message"] })] })] })] }))] })] }) })] })] }) }));
};
export default AffichageMemoire;
